# Nanobrowser 项目结构分析文档

## 目录树结构
```
nanobrowser/
├── chrome-extension/                 # Chrome 扩展核心配置与资源
│   ├── public/                       # 公共静态资源
│   │   ├── permission/               # 权限相关页面
│   │   └── buildDomTree.js           # DOM 树构建脚本
│   ├── src/                          # 扩展源代码
│   │   ├── background/               # 后台服务逻辑
│   │   ├── browser/                  # 浏览器相关功能
│   │   └── services/                 # 各类服务模块
│   ├── utils/                        # 工具函数
│   ├── manifest.js                   # 扩展清单文件
│   ├── package.json                  # 扩展依赖配置
│   └── tsconfig.json                 # TypeScript 配置
├── packages/                         # 多包管理结构
│   ├── dev-utils/                    # 开发工具包
│   ├── hmr/                          # 热更新模块
│   ├── i18n/                         # 国际化支持
│   ├── schema-utils/                 # Schema 工具包
│   ├── shared/                       # 共享代码库
│   ├── storage/                      # 存储管理
│   ├── tailwind-config/              # Tailwind CSS 配置
│   ├── tsconfig/                     # TypeScript 配置
│   ├── ui/                           # UI 组件库
│   ├── vite-config/                  # Vite 构建配置
│   └── zipper/                       # 打包压缩工具
├── pages/                            # 页面应用
│   ├── content/                      # 内容脚本页面
│   ├── options/                      # 设置选项页面
│   └── side-panel/                   # 侧边栏面板页面
├── .github/                          # GitHub 相关配置
├── .husky/                           # Git 钩子配置
├── README.md                         # 项目说明文档
├── package.json                      # 根级依赖配置
├── pnpm-workspace.yaml               # pnpm 工作区配置
└── turbo.json                        # Turbo 构建配置
```

## 各目录作用详解
### 根目录 (./)
项目的根目录包含了整体的配置文件、文档以及工作区设置：

+ **package.json**: 定义了项目的元数据、依赖关系和构建脚本
+ **pnpm-workspace.yaml**: 将多个包组织为单一的工作区
+ **turbo.json**: 配置 Turbo 构建系统，用于优化多包构建过程
+ **README.md**: 项目介绍文档，包含安装指南和使用说明

### Chrome 扩展目录 (`chrome-extension/`)
这是扩展的核心部分，负责处理浏览器扩展的基本功能：

+ **manifest.js**: 动态生成 Chrome 扩展的清单文件，定义扩展权限、资源和行为
+ **public/**: 包含扩展运行所需的公共资源
    - **buildDomTree.js**: 构建网页 DOM 树的脚本，用于网页元素识别和交互
    - **permission/**: 处理麦克风等浏览器权限请求的页面
+ **src/**: 扩展的主要源代码
    - **background/**: 后台服务逻辑，包括 AI agent 系统、任务执行器等核心功能
    - **browser/**: 浏览器操作相关的模块，如 DOM 操作、页面上下文管理
    - **services/**: 提供各类服务，如分析跟踪、语音转文本等功能

### 包管理目录 (`packages/`)
采用 monorepo 结构，将不同功能模块拆分为独立的 npm 包：

#### 核心功能包
+ **storage/**: 负责扩展的数据存储，包括聊天历史、用户设置、提示词等
+ **shared/**: 被多个包共享的通用代码和工具函数
+ **i18n/**: 国际化支持，提供多语言翻译功能
+ **ui/**: 可复用的 UI 组件库，基于 React 和 Tailwind CSS

#### 开发工具包
+ **dev-utils/**: 开发过程中使用的辅助工具
+ **hmr/**: 热模块替换功能，提升开发体验
+ **schema-utils/**: JSON Schema 相关工具，用于验证和处理工具参数
+ **zipper/**: 扩展打包压缩工具，用于生成可分发的扩展包

#### 配置包
+ **tsconfig/**: TypeScript 配置，统一各包的编译设置
+ **tailwind-config/**: Tailwind CSS 配置，保持样式一致性
+ **vite-config/**: Vite 构建工具配置，简化各包的构建流程

### 页面目录 (`pages/`)
包含扩展的各种用户界面页面：

#### 用户界面页面
+ **side-panel/**: 主要的用户交互界面，提供聊天窗口和任务控制
    - 包含消息列表、输入框、书签等功能组件
    - 实现与后台 AI agent 的通信
+ **options/**: 扩展设置页面
    - 提供模型配置、防火墙设置、分析选项等
    - 允许用户自定义扩展行为
+ **content/**: 内容脚本，在网页上下文中运行
    - 处理网页与扩展之间的交互
    - 实现网页元素高亮、操作录制等功能

## 技术架构特点
### Monorepo 结构
该项目采用 monorepo 架构，通过 pnpm workspace 和 Turborepo 管理多个相关包，具有以下优势：

1. 代码共享：不同包之间可以轻松共享代码
2. 版本同步：所有包使用相同的版本号，便于发布管理
3. 构建优化：Turbo 可以并行构建相关包，并缓存构建结果

### 模块化设计
项目按照功能将代码划分为多个独立的包：

+ **关注点分离**：每个包专注于特定功能领域
+ **可维护性**：修改某个功能时影响范围明确
+ **可测试性**：每个模块可以独立进行单元测试

### 现代前端技术栈
+ **React**: 用于构建用户界面
+ **TypeScript**: 提供类型安全和更好的开发体验
+ **Tailwind CSS**: 实用优先的 CSS 框架
+ **Vite**: 快速的构建工具
+ **ESLint/Prettier**: 代码质量和格式化工具

